<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <title>Purple</title>
        
        <script src="cordova.js"></script>

        <script>
         // iOS
         function onNotificationAPN (event) {
             if (event.alert) {
                 navigator.notification.alert(
                     event.alert,
                     function(){},
                     "Notification"
                 );
             }

             if (event.sound) {
                 var snd = new Media(event.sound);
                 snd.play();
             }

             if (event.badge) {
                 window.plugins.pushNotification.setApplicationIconBadgeNumber(function(){alert("badge success")}, function(){alert("badge error")}, event.badge);
             }

             // update/reload orders list view
             util.ctl('Orders').loadOrdersList(true);
             // if on a specific order page, just go back to the orders list
             // because it gets complicated to update the particular order page
             if (util.ctl('Orders').getOrder() !== null) {
                 util.ctl('Orders').backToOrders();
             }
         }

         // Android
         function onNotification(e) {
             switch( e.event ) {
                 case 'registered':
                     if ( e.regid.length > 0 ) {
                         // Your GCM push server needs to know the regID before it can push to this device
                         // here is where you might want to send it the regID for later use.
                         util.ctl('Main').registerDeviceForPushNotifications(e.regid, "gcm");
                     }
                     break;

                 case 'message':
                     var message = (e["payload"]["default"] || e.payload.message);
                     var fromValidSource = (util.GCM_SENDER_ID === e["from"]);

                     if (e.foreground) {
                         //console.log("foreground notification");
                     } else {
                         // otherwise we were launched because the user touched a notification in the notification tray.
                         if (e.coldstart) {
                             //console.log("background coldstart notification");
                         } else {
                             //console.log("background no coldstart notification");
                         }
                     }

                     if (fromValidSource) {
                         navigator.notification.alert(
                             message,
                             function(){},
                             "Notification"
                         );
                         // update/reload orders list view
                         util.ctl('Orders').loadOrdersList(true);
                         // if on a specific order page, just go back to the orders list
                         // because it gets complicated to update the particular order page
                         if (util.ctl('Orders').getOrder() !== null) {
                             util.ctl('Orders').backToOrders();
                         }
                     }
                     
                     break;

                 case 'error':
                     console.log('ERROR -> MSG:' + e.msg);
                     break;

                 default:
                     console.log('EVENT -> Unknown, an event was received and we do not know what it is');
                     break;
             }
         }
        </script>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0p8k_hdb6m-xvAOosuYQnkDwjsn8NjFg&libraries=places"></script>
        
        <script id="microloader" type="text/javascript" src=".sencha/app/microloader/development.js"></script>
        
        <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    </head>
    <body style="background-color: #EDEDED;">
      
    </body>
</html>
