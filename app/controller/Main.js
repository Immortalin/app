// Generated by CoffeeScript 1.3.3

Ext.define('Purple.controller.Main', {
  extend: 'Ext.app.Controller',
  requires: ['Purple.view.RequestForm'],
  config: {
    refs: {
      mainContainer: 'maincontainer',
      topToolbar: 'toptoolbar',
      backButton: '[ctype=backButton]'
    },
    control: {
      patientWelcome: {
        patientWelcomeStart: 'patientWelcomeStart',
        patientWelcomeAbort: 'patientWelcomeAbort'
      }
    }
  },
  launch: function() {
    var requestForm;
    this.callParent(arguments);
    requestForm = Ext.create('Purple.view.RequestForm');
    this.getMainContainer().add([requestForm]);
    return this.gpsIntervalRef = setInterval(Ext.bind(this.updateLatlng, this), 10000);
  },
  updateLatlng: function() {
    var _ref,
      _this = this;
    if ((_ref = this.updateLatlngBusy) == null) {
      this.updateLatlngBusy = false;
    }
    if (!this.updateLatlngBusy) {
      this.updateLatlngBusy = true;
      return navigator.geolocation.getCurrentPosition((function(position) {
        _this.updateLatlngBusy = false;
        return _this.latlng = "" + position.coords.latitude + "," + position.coords.longitude;
      }), (function() {
        return _this.updateLatlngBusy = false;
      }), {
        maximumAge: 0,
        enableHighAccuracy: true
      });
    }
  }
});
