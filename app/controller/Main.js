// Generated by CoffeeScript 1.3.3

Ext.define('Purple.controller.Main', {
  extend: 'Ext.app.Controller',
  requires: ['Purple.view.MapForm', 'Purple.view.RequestForm'],
  config: {
    refs: {
      mainContainer: 'maincontainer',
      topToolbar: 'toptoolbar',
      menuButton: '[ctype=menuButton]'
    },
    control: {
      menuButton: {
        menuButtonTap: 'menuButtonHandler'
      }
    }
  },
  launch: function() {
    this.callParent(arguments);
    this.gpsIntervalRef = setInterval(Ext.bind(this.updateLatlng, this), 10000);
    return this.updateLatlng();
  },
  updateLatlng: function() {
    var _ref,
      _this = this;
    if ((_ref = this.updateLatlngBusy) == null) {
      this.updateLatlngBusy = false;
    }
    if (!this.updateLatlngBusy) {
      this.updateLatlngBusy = true;
      return navigator.geolocation.getCurrentPosition((function(position) {
        _this.updateLatlngBusy = false;
        _this.lat = position.coords.latitude;
        return _this.lng = position.coords.longitude;
      }), (function() {
        return _this.updateLatlngBusy = false;
      }), {
        maximumAge: 0,
        enableHighAccuracy: true
      });
    }
  },
  menuButtonHandler: function() {
    return this.getMainContainer().toggleContainer();
  }
});
